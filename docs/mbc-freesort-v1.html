<!DOCTYPE html>
<html>
  <head>
    <script src="jspsych/dist/jspsych.js"></script>
    <script src="jspsych/dist/plugin-instructions.js"></script>
    <script src="jspsych/dist/plugin-survey-html-form.js"></script>
    <script src="jspsych/dist/plugin-canvas-keyboard-response.js"></script>
    <script src="jspsych/dist/plugin-preload.js"></script>
    <script src="jspsych/dist/plugin-html-button-response.js"></script>
    <script src="jspsych/dist/plugin-image-button-response.js"></script>
    <script src="jspsych/dist/plugin-video-button-response.js"></script>
    <script src="jspsych/dist/plugin-free-sort.js"></script>
    <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
    <link rel="stylesheet" href="jspsych/dist/jspsych.css">
    <style>
      #quitButton {
        position: fixed;
        bottom: 10px;
        right: 10px;
        padding: 10px;
        background-color: white;
        color: black;
        border: 2px solid black;
        cursor: pointer;
        font-size: 16px;
      }
    </style>
  </head>
  <body></body>

  <button id="quitButton">Quit</button>

  
  <script>
      document.getElementById('quitButton').addEventListener('click', function() {
      jsPsych.abortExperiment('The participant chose to quit the experiment.');
    });

  var jsPsych = initJsPsych({
    default_iti: 250,
    on_finish: function() {
      //window.location = "https://connect.cloudresearch.com/participant/project/478F668072/complete";
      jsPsych.data.displayData();

    },
    show_progress_bar: true
  });

  var preload = {
    type: jsPsychPreload,
    auto_preload: true
  };

  var instructions = {
      type: jsPsychInstructions,s
      pages: ['<br>Hi there! Today, we’re going to play a fun game with some words. ' +
      '<br>You will see cards showing different experiences a person can have. ' +
      '<br>Your job is to group these cards into groups that make sense to you. ' +
      '<br>There are no right or wrong answers—just put them together in ways that feel right! ' +
      '<br>Let us see a practice example. '
      ],
      show_clickable_nav: true
    };

  var example_image = {
  type: jsPsychHtmlButtonResponse,
  stimulus: '<div style="text-align: center;">' +
              '<p>This is an example way to group all 15 events.<br>' +
              'In this example, the 15 items are placed in four groups. However, you can create as few or as many groups as you would like.<br>' +
              'Just ensure all items are inside the circle. ' +
              'When you are ready, click "Next" to begin.</p>' +
              '<img src="images/keynote/example.png" style="width: 530px; height: 460px; margin-top: 10px;">' +
            '</div>',
  choices: ['Next']
};


var example_video = {
  type: jsPsychVideoButtonResponse,
  stimulus: ['video/example.mp4'],
  choices: ['Next'], 
  // width: 854, //Instead of specifying a fixed width, we're making it relative in videoElement.style.width
  autoplay: false,
  response_ends_trial: true,
  response_allowed_while_playing: false,
  prompt: `
        <button id="playButton" style="margin-top: -5px;">Play</button>
        <div style="margin-top: 10px; text-align: center;">
        <p>This video shows an example way to drag and drop the events into groups. <br> You can create as many or as few groups as you would like. Hit 'play' to watch!</p>
      </div>
  `,
  data: {trial_id: 'example_videos'},
  on_load: function() {
      // Move the Next button immediately as the trial loads
      var nextButton = jsPsych.getDisplayElement().querySelector('.jspsych-btn');
      nextButton.style.position = 'relative';
      nextButton.style.top = 'auto';
      nextButton.style.right = 'auto';
      nextButton.style.bottom = '-160px'; // Adjust this value as needed to position the Next button
      nextButton.style.left = '50%'; // Center the button horizontally
      nextButton.style.transform = 'translateX(-50%)'; // Ensure it's centered

      var videoElement = jsPsych.getDisplayElement().querySelector('video');
      videoElement.style.width = '60vw';  // This makes the video width 80% of the viewport width

      // Add outline and other custom styles to the video
      videoElement.style.outline = '1px solid gray'; // Outline color and width
      //videoElement.style.borderRadius = '5px';      // Rounded corners for the outline

      document.getElementById('playButton').addEventListener('click', function(){
          videoElement.play();
          this.style.visibility = 'hidden'; 
      });
  }
};

    const phrases = [
    "see something",
    "choose what to do",
    "think about something",
    "hear something",
    "remember something",
    "jump up and down",
    "kick something",
    "take a walk",
    "sit down",
    "reach for something",
    "feel scared",
    "experience pain",
    "feel sick",
    "get tired",
    "become hungry"
];

  // Function to create text images
  function createTextImage(text) {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 220;
    canvas.height = 50;
    ctx.fillStyle = 'black';
    ctx.font = '20px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(text, canvas.width / 2, canvas.height / 2);

    return canvas.toDataURL();
  }

  // Create images from phrases
  const phraseImages = phrases.map(createTextImage);

  var trial_sorting = {
    type: jsPsychFreeSort,
    stimuli: phraseImages,  // Use generated text images
    stim_height: 50,
    stim_width: 220,
    sort_area_height: 600,
    sort_area_width: 600,
    prompt: 'Please group similar phrases together. Take as long as you would like.<br>',
    scale_factor: 1.1, // Set close to 1.0 for subtle magnification or 1.0 to disable
    column_spread_factor: .9,
    //change_border_background_color: false,  // Disable background color change
  };




// Run the trials in sequence
jsPsych.run([preload, instructions, example_video, trial_sorting]);
  </script>
</html>
