<!DOCTYPE html>
<html>
  <head>
    <script src="jspsych/dist/jspsych.js"></script>
    <script src="jspsych/dist/plugin-instructions.js"></script>
    <script src="jspsych/dist/plugin-html-slider-response.js"></script>
    <link rel="stylesheet" href="jspsych/dist/jspsych.css">
    <style>
      #quitButton {
        position: fixed;
        bottom: 10px;
        right: 10px;
        padding: 10px;
        background-color: white;
        color: black;
        border: 2px solid black;
        cursor: pointer;
        font-size: 16px;
      }
    </style>
  </head>
  <body></body>

  <button id="quitButton">Quit</button>

  <script>
    document.getElementById('quitButton').addEventListener('click', function() {
      jsPsych.abortExperiment('The participant chose to quit the experiment.');
    });

    var jsPsych = initJsPsych({
      default_iti: 250,
      on_finish: function() {
        window.location = "https://connect.cloudresearch.com/participant/project/987AE15E5A/complete";
      },
      show_progress_bar: true
    });

    var cognitive = ['remember something', 'hear something', 'think about something', 'choose what to do', 'see something'];
    var physical = ['reach for something', 'sit down', 'take a walk', 'kick something', 'jump up and down'];
    var physiological = ['feel hungry', 'feel tired', 'feel sick', 'feel pain', 'feel scared'];

    var categories = {
      cognitive: cognitive,
      physical: physical,
      physiological: physiological
    };

    function convertToPastTense(item) {
      if (item === "feel hungry") return "felt hungry";
      if (item === "reach for something") return "reached for something";
      if (item === "remember something") return "remembered something";
      if (item === "hear something") return "heard something";
      if (item === "kick something") return "kicked something";
      if (item === "sit down") return "sat down";
      if (item === "see something") return "saw something";
      if (item === "take a walk") return "took a walk";
      if (item === "jump up and down") return "jumped up and down";
      if (item.startsWith("choose")) return "chose what to do";
      if (item.startsWith("feel")) return "felt " + item.slice(5);
      if (item.startsWith("think")) return "thought about something";
      return item;
    }

    function addIng(item) {
      if (item === "think about something") return "thinking about something";
      if (item === "reach for something") return "reaching for something";
      if (item === "kick something") return "kicking something";
      if (item === "remember something") return "remembering something";
      if (item === "feel hungry") return "feeling hungry";
      if (item === "hear something") return "hearing something";
      if (item === "sit down") return "sitting down";
      if (item === "see something") return "seeing something";
      if (item === "take a walk") return "taking a walk";
      if (item === "jump up and down") return "jumping up and down";
      if (item.startsWith("choose")) return "choosing what to do";
      if (item.startsWith("feel")) return "feeling " + item.slice(5);
      return item;
    }

    function createPairs(categories) {
      var pairs = [];
      var categoryKeys = Object.keys(categories);

      for (var i = 0; i < categoryKeys.length; i++) {
        for (var j = i; j < categoryKeys.length; j++) {
          var categoryA = categoryKeys[i];
          var categoryB = categoryKeys[j];

          if (i === j) {
            for (var x = 0; x < categories[categoryA].length; x++) {
              for (var y = 0; y < categories[categoryA].length; y++) {
                if (x !== y) {
                  pairs.push({
                    itemA: categories[categoryA][x],
                    itemB: categories[categoryA][y],
                    categoryA: categoryA,
                    categoryB: categoryB
                  });
                }
              }
            }
          } else {
            for (var x = 0; x < categories[categoryA].length; x++) {
              for (var y = 0; y < categories[categoryB].length; y++) {
                pairs.push({
                  itemA: categories[categoryA][x],
                  itemB: categories[categoryB][y],
                  categoryA: categoryA,
                  categoryB: categoryB
                });
                pairs.push({
                  itemA: categories[categoryB][y],
                  itemB: categories[categoryA][x],
                  categoryA: categoryB,
                  categoryB: categoryA
                });
              }
            }
          }
        }
      }
      return pairs;
    }

    var pairs = jsPsych.randomization.shuffle(createPairs(categories));

    var trials = pairs.map(function(pair, index) {
      var itemA_past = convertToPastTense(pair.itemA);
      var itemB_past = convertToPastTense(pair.itemB);
      var itemA_withIng = addIng(pair.itemA);

      return {
        type: jsPsychHtmlSliderResponse,
        stimulus: `<p style="font-size: 32px;">First, Sarah <strong>${itemA_past}</strong>.
                   <span style="font-size: 32px">Then, she <strong>${itemB_past}</strong>.</span></p>
                   <p><span style="font-size:32px">Do you think that <strong>${itemA_withIng}</strong> made her <strong>${pair.itemB}</strong>?</span></p>`,
        labels: ['Definitely not', 'Maybe not', 'Unsure', 'Maybe yes', 'Definitely yes'],
        slider_width: 1000,
        require_movement: true,
        data: {
          trial_id: 'causal_trial_' + (index + 1),
          itemA: pair.itemA,
          itemB: pair.itemB,
          categoryA: pair.categoryA,
          categoryB: pair.categoryB
        }
      };
    });

    jsPsych.run(trials);

  </script>
</html>