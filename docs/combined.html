<!DOCTYPE html>
<html>
    <head>
        <script src="https://unpkg.com/jspsych"></script>
        <script src="jspsych/dist/plugin-instructions.js"></script>
        <script src="https://unpkg.com/@jspsych-contrib/plugin-survey-slider@1.0.0"></script>
        <link href="https://unpkg.com/jspsych/css/jspsych.css" rel="stylesheet" type="text/css">
    </head>
    <body></body>
    <script>
        var jsPsych = initJsPsych({
            on_finish: function() {
                jsPsych.data.displayData();
            },
            show_progress_bar: true
        });

        var slider_labels = ['Definitely not', 'Maybe not', 'Unsure', 'Maybe yes', 'Definitely yes'];

        var instructions = {
            type: jsPsychInstructions,
            pages: [
                '<div style="font-size: 22px; text-align: center;">' +
                'In this game, you will see pairs of events that a person might experience. <br>' +
                'For example, feeling happy or hearing a noise.<br>Your job is to tell us if experiencing one thing could make someone experience the other.<br>' +
                'Click "Next" to start.</div>'
            ],
            show_clickable_nav: true
        };

        var cognitive = ['remember something', 'hear something', 'think about something', 'choose what to do', 'see something'];
        var physical = ['reach for something', 'sit down', 'take a walk', 'kick something', 'jump up and down'];
        var physiological = ['feel hungry', 'feel tired', 'feel sick', 'feel pain', 'feel scared'];

        var categories = {
            cognitive: cognitive,
            physical: physical,
            physiological: physiological
        };

        // Combine all items into a single list
        var allItems = cognitive.concat(physical, physiological);

        // Shuffle items for both conditions
        var shuffledItemsCondition1 = jsPsych.randomization.shuffle(allItems);
        var shuffledItemsCondition2 = jsPsych.randomization.shuffle(allItems);

        // Function to add "ing" to an item
        function addIng(item) {
            if (item === "think about something") return "thinking about something";
            if (item === "reach for something") return "reaching for something";
            if (item === "kick something") return "kicking something";
            if (item === "remember something") return "remembering something";
            if (item === "feel hungry") return "feeling hungry";
            if (item === "hear something") return "hearing something";
            if (item === "sit down") return "sitting down";
            if (item === "see something") return "seeing something";
            if (item === "take a walk") return "taking a walk";
            if (item === "jump up and down") return "jumping up and down";
            if (item.startsWith("choose")) return "choosing what to do";
            if (item.startsWith("feel")) return "feeling " + item.slice(5);
            return item;
        }

        // **Condition 1: Effect fixed, causes vary**
        var condition1Pages = [];
        shuffledItemsCondition1.forEach(function(effectItem) {
            var shuffledCauses = jsPsych.randomization.shuffle(
                allItems.filter(causeItem => causeItem !== effectItem) // Exclude self-pairing
            );

            var questions = shuffledCauses.map(function(causeItem) {
                var causeItemWithIng = addIng(causeItem);
                return {
                    prompt: `<p><span style="font-size:20px">Can <strong>${causeItemWithIng}</strong> make someone <strong>${effectItem}</strong>?</span></p>`,
                    ticks: slider_labels
                };
            });

            condition1Pages.push({
                type: jsPsychSurveySlider,
                preamble: `<p><span style="font-size:25px">To what extent can the first event make the second happen?</span></p>`,
                questions: questions,
                slider_width: 800,
                require_movement: true // Ensure movement is required
            });
        });

        // **Condition 2: Cause fixed, effects vary**
        var condition2Pages = [];
        shuffledItemsCondition2.forEach(function(causeItem) {
            var shuffledEffects = jsPsych.randomization.shuffle(
                allItems.filter(effectItem => effectItem !== causeItem) // Exclude self-pairing
            );

            var questions = shuffledEffects.map(function(effectItem) {
                var causeItemWithIng = addIng(causeItem);
                return {
                    prompt: `<p><span style="font-size:20px">Can <strong>${causeItemWithIng}</strong> make someone <strong>${effectItem}</strong>?</span></p>`,
                    ticks: slider_labels
                };
            });

            condition2Pages.push({
                type: jsPsychSurveySlider,
                preamble: `<p><span style="font-size:25px">To what extent can the first event make the second happen?</span></p>`,
                questions: questions,
                slider_width: 800 //,
                //require_movement: true // Ensure movement is required
            });
        });

        // Randomize participant to one of the two conditions
        var chosenCondition = Math.random() < 0.5 ? condition1Pages : condition2Pages;

        // Combine instructions and the chosen condition
        var timeline = [instructions].concat(chosenCondition);

        // Run the experiment
        jsPsych.run(timeline);
    </script>
</html>